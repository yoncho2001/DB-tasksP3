CREATE DATABASE AIRLINE
GO
USE AIRLINE
GO

DROP TABLE AIRPLANE
DROP TABLE AIRLINE
DROP TABLE AGENCY
DROP TABLE CUSTOMER
DROP TABLE AIRPORT
DROP TABLE FLIGHT
DROP TABLE BOOKING

CREATE TABLE AIRLINE (
 CODE CHAR(2) NOT NULL,
 NAME CHAR(50) NOT NULL UNIQUE,
 COUNTRY VARCHAR (20) NOT NULL
);

CREATE TABLE AIRPLANE (
 CODE CHAR(3) NOT NULL,
 TYPE CHAR(10) NOT NULL,
 SEATS INT  CHECK (SEATS >= 0) NOT NULL,
 YEAR INT
);

CREATE TABLE AGENCY (
 NAME CHAR(50) NOT NULL UNIQUE,
 COUNTRY VARCHAR (20) NOT NULL,
 CITY VARCHAR (20) NOT NULL,
 PHONE VARCHAR(10)
);

CREATE TABLE CUSTOMER(
 ID INT NOT NULL,
 FNAME CHAR(50) NOT NULL,
 LNAME CHAR(50) NOT NULL,
 EMAIL CHAR(50) CHECK ((LEN(EMAIL) >= 6) AND (EMAIL LIKE '_%@_%._%')) NOT NULL 
);

CREATE TABLE AIRPORT(
 CODE CHAR(3) NOT NULL,
 NAME CHAR(50) NOT NULL UNIQUE,
 COUNTRY VARCHAR (20) NOT NULL,
 CITY VARCHAR (20) NOT NULL,
);

CREATE TABLE BOOKING(
 CODE CHAR(6) NOT NULL,
 AGENCY CHAR(50) NOT NULL,
 AIRLINE_CODE  CHAR(2) NOT NULL,
 FLIGHT_NUMBER CHAR(6) NOT NULL,
 CUSTOMER_ID INT NOT NULL,
 BOOKING_DATE DATETIME NOT NULL,
 FLIGHT_DATE DATETIME NOT NULL,
 PRICE DECIMAL(10, 2) NOT NULL,
 STATUS INT DEFAULT 0 CHECK (STATUS IN (0, 1)) NOT NULL,
 CONSTRAINT CHEK_DATE CHECK (FLIGHT_DATE >= BOOKING_DATE),
 CONSTRAINT CHEK_STATUS CHECK (STATUS IN (0, 1))
);

CREATE TABLE FLIGHT(
 FNUMBER CHAR(6) NOT NULL,
 AIRLINE_OPERATOR  CHAR(2) NOT NULL,
 DEP_AIRPORT CHAR(3) NOT NULL,
 ARR_AIRPORT CHAR(3) NOT NULL,
 FLIGHT_TIME TIME NOT NULL,
 FLIGHT_DURATION INT NOT NULL,
 AIRPLANE CHAR(3) NOT NULL
);

ALTER TABLE AIRLINE ADD CONSTRAINT PK_AIRLINE PRIMARY KEY (CODE);

ALTER TABLE AIRPLANE ADD CONSTRAINT PK_AIRPLANE PRIMARY KEY (CODE);

ALTER TABLE AGENCY ADD CONSTRAINT PK_AGENCY PRIMARY KEY (NAME,COUNTRY);

ALTER TABLE CUSTOMER ADD CONSTRAINT PK_CUSTOMER PRIMARY KEY (ID);

ALTER TABLE AIRPORT ADD CONSTRAINT PK_AIRPORT PRIMARY KEY (CODE);

ALTER TABLE BOOKING ADD CONSTRAINT PK_BOOKING PRIMARY KEY (CODE);

ALTER TABLE FLIGHT ADD CONSTRAINT PK_FLIGHT PRIMARY KEY (FNUMBER);

ALTER TABLE FLIGHT ADD CONSTRAINT FK_FLIGHT_AIRLINE FOREIGN KEY(AIRLINE_OPERATOR) REFERENCES AIRLINE(CODE);

ALTER TABLE BOOKING ADD CONSTRAINT FK_BOOKING_AIRLINE FOREIGN KEY(AIRLINE_CODE) REFERENCES AIRLINE(CODE);

ALTER TABLE FLIGHT ADD CONSTRAINT FK_DEP_AIRPORT FOREIGN KEY(DEP_AIRPORT) REFERENCES AIRPORT(CODE);

ALTER TABLE FLIGHT ADD CONSTRAINT FK_ARR_AIRPORT FOREIGN KEY(ARR_AIRPORT) REFERENCES AIRPORT(CODE);

ALTER TABLE FLIGHT ADD CONSTRAINT FK_FLIGHT_AIRPLANE FOREIGN KEY(AIRPLANE) REFERENCES AIRPLANE(CODE);

ALTER TABLE BOOKING ADD CONSTRAINT FK_BOOKING_AGENCY FOREIGN KEY(AGENCY) REFERENCES AGENCY(NAME);

ALTER TABLE BOOKING ADD CONSTRAINT FK_FLIGHT_BOOKING FOREIGN KEY(FLIGHT_NUMBER) REFERENCES FLIGHT(FNUMBER);

ALTER TABLE BOOKING ADD CONSTRAINT FK_CUSTOMER_BOOKING FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(ID);

/*DATA*/

INSERT INTO AIRLINE
VALUES ('AZ', 'Alitalia', 'Italy'),
('BA', 'British Airways', 'United Kingdom'),
('LH', 'Lufthansa', 'Germany'),
('SR', 'Swissair', 'Switzerland'),
('FB', 'Bulgaria Air', 'Bulgaria'),
('AF', 'Air France', 'France'),
('TK', 'Turkish Airlines', 'Turkey'),
('AA', 'American Airlines', 'United States');
INSERT INTO AIRPORT
VALUES ('SOF', 'Sofia International', 'Bulgaria', 'Sofia'),
('CDG', 'Charles De Gaulle', 'France', 'Paris'),
('ORY', 'Orly', 'France', 'Paris'),
('LBG', 'Le Bourget', 'France', 'Paris'),
('JFK', 'John F Kennedy International', 'United States', 'New York'),
('ORD', 'Chicago O''Hare International', 'United States', 'Chicago'),
('FCO', 'Leonardo da Vinci International', 'Italy', 'Rome'),
('LHR', 'London Heathrow', 'United Kingdom', 'London');
INSERT INTO AIRPLANE
VALUES ('319', 'Airbus A31', 150, 1993),
('320', 'Airbus A32', 280, 1984),
('321', 'Airbus A32', 150, 1989),
('100', 'Fokker 100', 80, 1991),
('738', 'Boeing 737', 90, 1997),
('735', 'Boeing 737', 90, 1995);
INSERT INTO FLIGHT
VALUES ('FB1363', 'AZ', 'SOF', 'ORY', '12:45', 100, '738'),
('FB1364', 'AZ', 'CDG', 'SOF', '10:00', 120, '321'),
('SU2060', 'AZ', 'LBG', 'SOF', '11:10', 110, '738'),
('SU2061', 'TK', 'SOF', 'JFK', '13:00', 110, '320'),
('FB363', 'FB', 'SOF', 'ORD', '15:10', 110, '738'),
('FB364', 'FB', 'LHR', 'SOF', '21:05', 120, '738');
INSERT INTO CUSTOMER
VALUES (1, 'Petar', 'Milenov', 'petter@mail.com'),
(2, 'Dimitar', 'Petrov', 'petrov@mail.com'),
(3, 'Ivan', 'Ivanov', 'ivanov@mail.com'),
(4, 'Petar', 'Slavov', 'slavov@mail.com'),
(5, 'Bogdan', 'Bobov', 'bobov@mail.com');
INSERT INTO AGENCY
VALUES ('Travel One', 'Bulgaria', 'Sofia', '0783482233'),
('Travel Two', 'Bulgaria', 'Plovdiv', '02882234'),
('Travel Tour', 'Bulgaria', 'Sofia', NULL),
('Aerotravel', 'Bulgaria', 'Varna', '02884233');
INSERT INTO BOOKING
VALUES ('YN298P', 'Travel One', 'FB', 'FB1363', 1, '2013-11-18', '2013-12-25', 300, 0),
('YA298P', 'Travel Two', 'FB', 'FB1364', 2, '2013-12-18', '2013-12-25', 300, 1),
('YB298P', 'Travel Tour', 'FB', 'SU2060', 3, '2014-01-18', '2014-02-25', 400, 0),
('YC298P', 'Travel One', 'FB', 'SU2061', 4, '2014-11-11', '2014-11-25', 350, 0),
('YD298P', 'Travel Tour', 'FB', 'FB363', 1, '2013-11-03', '2013-12-20', 250, 1),
('YE298P', 'Aerotravel', 'FB', 'FB364', 2, '2013-11-07', '2013-12-21', 150, 0);